<!DOCTYPE html>
<html>
<head>
    <title>School Timetable Grid</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .filters { display: flex; gap: 15px; margin-bottom: 20px; padding: 15px; background: #e9ecef; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th, td { border: 1px solid #dee2e6; text-align: center; padding: 10px; height: 70px; word-wrap: break-word; }
        th { background: #007bff; color: white; font-size: 0.9em; }
        .day-column { background: #f8f9fa; font-weight: bold; width: 100px; }
        .slot { font-size: 0.8em; }
        .subject { color: #007bff; font-weight: bold; display: block; }
        .teacher { color: #555; font-style: italic; }
        .btn { padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <a href="{% url 'dashboard' %}" style="text-decoration: none;">â¬… Back to Dashboard</a>
        <h2>Weekly Schedule (8 Periods)</h2>

        <form method="GET" class="filters">
            <select name="classroom">
                <option value="">-- Select Class --</option>
                {% for c in classrooms %}
                    <option value="{{ c.id }}" {% if request.GET.classroom == c.id|stringformat:"i" %}selected{% endif %}>{{ c.name }}</option>
                {% endfor %}
            </select>

            <select name="teacher">
                <option value="">-- Select Teacher --</option>
                {% for t in teachers %}
                    <option value="{{ t.id }}" {% if request.GET.teacher == t.id|stringformat:"i" %}selected{% endif %}>{{ t.profile.user.username }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn">Filter</button>
            <a href="{% url 'view_timetable' %}" style="margin-top: 8px; font-size: 0.8em;">Clear</a>
        </form>

        <table>
            <thead>
                <tr>
                    <th style="width: 100px;">Day / Period</th>
                    {% for p in periods %}
                        <th>P{{ p }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for day in days %}
                <tr>
                    <td class="day-column">{{ day }}</td>
                    {% for p in periods %}
                        <td>
                            {% for entry in entries %}
                                {% if entry.day == day and entry.period == p %}
                                    <div class="slot">
                                        <span class="subject">{{ entry.subject.name }}</span>
                                        <span class="teacher">{{ entry.teacher.profile.user.username }}</span>
                                        {% if not request.GET.classroom %}
                                            <br><small>[{{ entry.classroom.name }}]</small>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>